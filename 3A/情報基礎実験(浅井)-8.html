<!DOCTYPE html>
<html lang="ja">
    <head>
        <link rel="shortcut icon" href="https://iwasakishuto.github.io/images/apple-touch-icon/University.png" />

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Shuto" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="3A, 情報基礎実験(浅井), 情報基礎実験(浅井), " />
<meta property="og:image" content="https://iwasakishuto.github.io/images/FacebookImage/University.png"/>

<meta property="og:title" content="Nussinov Algorithm "/>
<meta property="og:url" content="https://iwasakishuto.github.io/University/3A/情報基礎実験(浅井)-8.html" />
<meta property="og:description" content="Nussinov Algorithmは、最もシンプルな二次構造予測アルゴリズムである。 「最大いくつの塩基対を作ることができるか」を調べる。 動的計画法を用いて効率的に調べるために、以下のようなPseudoknotは無視している。様々な重要なRNAが、Pseudoknotの形をとることが確認されているが、相対的にこのような構造をとる確率は低いので、計算の効率を優先し、これらを無視する。 Algorithm¶ ※「$i$ から $j$ までの部分塩基配列で最大幾つの塩基対が作れるか」を $\gamma(i,j)$ が保持している。 今回の実装では $j-i-1 ポイントはRecursionの最後の式で、「$i$ から $k$ までの部分塩基配列」と「$k+1$ から $j$ までの部分塩基配列」を足し合わせる操作を行う。（Bifurcation） Initialization:¶$$\begin{aligned} \gamma(i,i)&amp;=0&amp;\text{ for }i=1\text{ to }L\\ \gamma(i,i-1)&amp;=0&amp;\text{ for }i=2\text{ to }L \end{aligned}$$Recursion:¶$$ \gamma(i,j) = \max \begin{cases} \gamma(i+1,j)\\ \gamma(i,j-1)\\ \gamma(i+1,j-1)+\delta(i,j)\\ \max_{i\leq k\verb|TraceBack¶基本的なアルゴリズムは同じですが、Bifurcationが起きた際にトレースバックポインターを複数用意する必要があることには注意が必要です。 bp = [] stack = [(0,N-1)] while(stack): i,j = stack.pop(0) delta = 1 if self._is_bp(sequence[i],sequence[j]) and (j-i&gt;3) else" />
<meta property="og:site_name" content="3A" />
<meta property="og:article:author" content="Shuto" />
<meta property="og:article:published_time" content="2019-10-06T00:00:00+09:00" />
<meta property="og:article:modified_time" content="2019-10-06T00:00:00+09:00" />
<meta name="twitter:title" content="Nussinov Algorithm ">
<meta name="twitter:description" content="Nussinov Algorithmは、最もシンプルな二次構造予測アルゴリズムである。 「最大いくつの塩基対を作ることができるか」を調べる。 動的計画法を用いて効率的に調べるために、以下のようなPseudoknotは無視している。様々な重要なRNAが、Pseudoknotの形をとることが確認されているが、相対的にこのような構造をとる確率は低いので、計算の効率を優先し、これらを無視する。 Algorithm¶ ※「$i$ から $j$ までの部分塩基配列で最大幾つの塩基対が作れるか」を $\gamma(i,j)$ が保持している。 今回の実装では $j-i-1 ポイントはRecursionの最後の式で、「$i$ から $k$ までの部分塩基配列」と「$k+1$ から $j$ までの部分塩基配列」を足し合わせる操作を行う。（Bifurcation） Initialization:¶$$\begin{aligned} \gamma(i,i)&amp;=0&amp;\text{ for }i=1\text{ to }L\\ \gamma(i,i-1)&amp;=0&amp;\text{ for }i=2\text{ to }L \end{aligned}$$Recursion:¶$$ \gamma(i,j) = \max \begin{cases} \gamma(i+1,j)\\ \gamma(i,j-1)\\ \gamma(i+1,j-1)+\delta(i,j)\\ \max_{i\leq k\verb|TraceBack¶基本的なアルゴリズムは同じですが、Bifurcationが起きた際にトレースバックポインターを複数用意する必要があることには注意が必要です。 bp = [] stack = [(0,N-1)] while(stack): i,j = stack.pop(0) delta = 1 if self._is_bp(sequence[i],sequence[j]) and (j-i&gt;3) else">

        <title>Nussinov Algorithm  · 3A
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/University/3A/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/University/3A/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/University/3A/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/University/3A/theme/css/admonition.css" media="screen">
        <!---->
        <link rel="apple-touch-icon" sizes="152x152" href="https://iwasakishuto.github.io/images/apple-touch-icon/University.png" type="image/png" />



        <!-- Use fontawesome Icon -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <!-- Syntax highlight -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/css/custom.css" media="screen">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <!-- LaTex -->
        <!-- Github env -->
        <!--<script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
        <script type="text/x-mathjax-config">
        	MathJax.Hub.Config({
        		tex2jax: {
        			inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        			displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
        		}
        	});
        </script>
        <!-- Mermaid -->
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" charset="UTF-8"></script>
        <script>
          mermaid.initialize({
            startOnLoad:true
          });
        </script>
        <script src="https://iwasakishuto.github.io/js/smooth-scroll.polyfills.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/University/3A/theme/css/jupyter.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="https://iwasakishuto.github.io/University/3A"><span class=site-name style="color: #80273F;"><i class="fa fa-book"></i> 3A</span></a>
                    <!--
                    <a class="brand" href="https://iwasakishuto.github.io/University/3A/"><span class=site-name style="margin-left:auto; margin-right:auto;"><i class="fas fa-book-reader"></i>3A</span></a>
                    -->
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="https://iwasakishuto.github.io/"><i class="fas fa-home"></i>Portfolio Top</a></li>
                            <li ><a href="https://iwasakishuto.github.io/University/3A/categories"><i class="fa fa-list-alt"></i> Categories</a></li>
                            <li ><a href="https://iwasakishuto.github.io/University/3A/tags"><i class="fa fa-tags"></i> Tags</a></li>
                            <li ><a href="https://iwasakishuto.github.io/University/3A/archives"><i class="fa fa-folder-open"></i> Archives</a></li>
                            <li><form class="navbar-search" action="https://iwasakishuto.github.io/University/3A/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="https://iwasakishuto.github.io/University/3A/情報基礎実験(浅井)-8.html"> Nussinov Algorithm  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Nussinov Algorithmは、最もシンプルな二次構造予測アルゴリズムである。</li>
<li><b>「最大いくつの塩基対を作ることができるか」</b>を調べる。</li>
<li>動的計画法を用いて効率的に調べるために、以下のような<span class="marker-pink">Pseudoknot</span>は無視している。様々な重要なRNAが、Pseudoknotの形をとることが確認されているが、相対的にこのような構造をとる確率は低いので、計算の効率を優先し、これらを無視する。</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://en.wikipedia.org/wiki/Pseudoknot"><img alt="Pseudoknot" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Pseudoknot.svg/1024px-Pseudoknot.svg.png" /></a></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Algorithm">Algorithm<a class="anchor-link" href="#Algorithm">¶</a></h3><ul>
<li><b>※「$i$ から $j$ までの部分塩基配列で最大幾つの塩基対が作れるか」</b>を $\gamma(i,j)$ が保持している。</li>
<li>今回の実装では $j-i-1<3$ の時は、$i,j$ が塩基対を作れないものとしている。</li>
<li>ポイントはRecursionの最後の式で、<b>「$i$ から $k$ までの部分塩基配列」</b>と<b>「$k+1$ から $j$ までの部分塩基配列」</b>を足し合わせる操作を行う。<span class="marker-pink">（Bifurcation）</span></li>
</ul>
<h4 id="Initialization:">Initialization:<a class="anchor-link" href="#Initialization:">¶</a></h4>$$\begin{aligned}
\gamma(i,i)&=0&\text{ for }i=1\text{ to }L\\
\gamma(i,i-1)&=0&\text{ for }i=2\text{ to }L
\end{aligned}$$<h4 id="Recursion:">Recursion:<a class="anchor-link" href="#Recursion:">¶</a></h4>$$
\gamma(i,j) = \max
\begin{cases}
\gamma(i+1,j)\\
\gamma(i,j-1)\\
\gamma(i+1,j-1)+\delta(i,j)\\
\max_{i\leq k\verb|<|j}\left[\gamma(i,k) + \gamma(k+1,j)\right]
\end{cases}
$$<h4 id="TraceBack">TraceBack<a class="anchor-link" href="#TraceBack">¶</a></h4><p>基本的なアルゴリズムは同じですが、<b>Bifurcationが起きた際にトレースバックポインターを複数用意する必要があることには注意が必要です。</b></p>
<div class="highlight"><pre><span></span><span class="n">bp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stack</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="k">while</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_bp</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sequence</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">></span><span class="mi">3</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">>=</span><span class="n">j</span><span class="p">):</span> <span class="k">continue</span>
    <span class="k">elif</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span> <span class="o">==</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="n">bp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">));</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Bifurcation</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">gamma</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
                <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>自作のモジュール<a href="https://github.com/iwasakishuto/Kerasy/blob/9501328343d49b22c5308132bf79bce240f7742e/kerasy/Bio/structure.py#L7">（kerasy.Bio.structure.Nussinov）</a>を使って実装します。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">kerasy.Bio.structure</span> <span class="k">import</span> <span class="n">Nussinov</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Nussinov</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 以下の形のパラメタファイルを受け取ります。</span>
<span class="o">!</span> cat params.json
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
    "type": "DNA",
    "Watson_Crick": true,
    "Wobble": true
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">load_params</span><span class="p">(</span><span class="s2">"params.json"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>| parameter  |value|
--------------------
|type        |  DNA|
|Watson_Crick|    1|
|Wobble      |    1|
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># サンプル配列</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="s2">"GCGGAAACGGGGTCA"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 最大ペアの配列</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">memorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-default-inverse-fg ansi-red-bg"> Nussinov Algorithm </span>
Score: <span class="ansi-blue-fg">3</span>

=================================================================
seq: GCGGAAACGGGGTCA
   :    (  ((   ))) 
=================================================================
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gamma</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">gamma</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># DP行列は以下のようになっています。</span>
<span class="n">model</span><span class="o">.</span><span class="n">_printAsTerai</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>\ G C G G A A A C G G G G T C A
G 0 0 0 0 0 0 0 1 2 2 2 2 2 3 3 
C - 0 0 0 0 0 0 1 2 2 2 2 2 3 3 
G - - 0 0 0 0 0 1 1 1 1 1 2 3 3 
G - - - 0 0 0 0 1 1 1 1 1 2 3 3 
A - - - - 0 0 0 0 0 0 0 1 2 2 2 
A - - - - - 0 0 0 0 0 0 1 2 2 2 
A - - - - - - 0 0 0 0 0 1 2 2 2 
C - - - - - - - 0 0 0 0 1 1 1 1 
G - - - - - - - - 0 0 0 0 0 1 1 
G - - - - - - - - - 0 0 0 0 1 1 
G - - - - - - - - - - 0 0 0 0 0 
G - - - - - - - - - - - 0 0 0 0 
T - - - - - - - - - - - - 0 0 0 
C - - - - - - - - - - - - - 0 0 
A - - - - - - - - - - - - - - 0 
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="$i,j$-が塩基対を組むときの塩基対最大化">$i,j$ が塩基対を組むときの塩基対最大化<a class="anchor-link" href="#$i,j$-が塩基対を組むときの塩基対最大化">¶</a></h3><p>塩基 $i,j$ が塩基対を組むという制約がある場合を考えます。これは、「$i$ から $j$ までの部分塩基配列を除いた残りで最大幾つの塩基対が作れるか」</b>を保持した $\omega(i,j)$ と $\gamma(i,j)$ を組み合わせることで効率的に求めることができます。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Algorithm">Algorithm<a class="anchor-link" href="#Algorithm">¶</a></h3><ul>
<li><b>「$i$ から $j$ までの部分塩基配列で最大幾つの塩基対が作れるか」</b>を $\gamma(i,j)$ が保持している。</li>
<li><b>「$i$ から $j$ までの部分塩基配列を除いた残りで最大幾つの塩基対が作れるか」</b>を $\omega(i,j)$ が保持している。</li>
</ul>
<h4 id="Initialization:">Initialization:<a class="anchor-link" href="#Initialization:">¶</a></h4>$$\omega(i,L) = 0$$<h4 id="Recursion:">Recursion:<a class="anchor-link" href="#Recursion:">¶</a></h4>$$
\omega(i,j) = \max
\begin{cases}
\omega(i-1,j)\\
\omega(i,j+1)\\
\omega(i-1,j+1)+\delta(i-1,j+1)\\
\max_{1\leq k\verb|<|i}\left[\omega(k,j) + \gamma(k,i-1)\right]\\
\max_{j\verb|<| k\leq L}\left[\omega(j+1,k) + \gamma(i,k)\right]
\end{cases}
$$
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">outside</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">memorize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">omega</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">omega</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># DP行列は以下のようになっています。</span>
<span class="n">model</span><span class="o">.</span><span class="n">_printAsTerai</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>\ G C G G A A A C G G G G T C A
G 3 3 3 2 2 2 1 1 1 0 0 0 0 0 0 
C - 3 3 3 3 3 2 1 1 1 1 1 1 0 0 
G - - 3 3 3 3 2 2 2 2 2 1 1 0 0 
G - - - 3 3 3 2 2 2 2 2 1 1 0 0 
A - - - - 3 3 2 2 2 2 2 1 1 0 0 
A - - - - - 3 3 2 2 2 2 2 1 0 0 
A - - - - - - 3 2 2 2 2 2 1 0 0 
C - - - - - - - 2 2 2 2 2 1 0 0 
G - - - - - - - - 3 3 3 2 2 1 1 
G - - - - - - - - - 3 3 3 3 2 2 
G - - - - - - - - - - 3 3 3 2 2 
G - - - - - - - - - - - 3 3 2 2 
T - - - - - - - - - - - - 3 2 2 
C - - - - - - - - - - - - - 2 2 
A - - - - - - - - - - - - - - 3 
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="$Z(i,j)$-の計算">$Z(i,j)$ の計算<a class="anchor-link" href="#$Z(i,j)$-の計算">¶</a></h3><table>
<thead><tr>
<th style="text-align:center">variable</th>
<th style="text-align:left">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$\gamma\left(i,j\right)$</td>
<td style="text-align:left">the maximum number of base-pairs <b>for</b> subsequence from $i$ to $j$.</td>
</tr>
<tr>
<td style="text-align:center">$\omega\left(i,j\right)$</td>
<td style="text-align:left">the maximum number of base-pairs <b>excluding</b> subsequence from $i$ to $j$.</td>
</tr>
</tbody>
</table>
<p>上記の定義より、$\gamma,\omega$ を用いて $Z(i,j)$ が以下のように求まることがわかります。</p>
$$Z(i,j) = \begin{cases}
\gamma\left(i+1,j-1\right) + 1 + \omega\left(i,j\right) & (\text{if }i\text{ and }j\text{-th nucleotides can form a base-pair})\\
0 & (\text{otherwise})
\end{cases}$$
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">ConstrainedMaximize</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">memorize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>\ G C G G A A A C G G G G T C A
G 0 0 0 0 0 0 0 2 0 0 0 0 0 3 0 
C - 0 0 0 0 0 0 0 3 3 3 3 0 0 0 
G - - 0 0 0 0 0 3 0 0 0 0 0 3 0 
G - - - 0 0 0 0 3 0 0 0 0 0 3 0 
A - - - - 0 0 0 0 0 0 0 0 3 0 0 
A - - - - - 0 0 0 0 0 0 0 3 0 0 
A - - - - - - 0 0 0 0 0 0 3 0 0 
C - - - - - - - 0 0 0 0 3 0 0 0 
G - - - - - - - - 0 0 0 0 0 2 0 
G - - - - - - - - - 0 0 0 0 3 0 
G - - - - - - - - - - 0 0 0 0 0 
G - - - - - - - - - - - 0 0 0 0 
T - - - - - - - - - - - - 0 0 0 
C - - - - - - - - - - - - - 0 0 
A - - - - - - - - - - - - - - 0 
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="備忘録">備忘録<a class="anchor-link" href="#備忘録">¶</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nussinov Algorithmでは、これまでの動的計画法とは異なり、 $i,j$ を斜め方向に舐める必要がありました。</p>
<p>そこで、その際に使用したコードを備忘録として残しておきます。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Nussinov Algorithm (γ)</span>
<span class="n">idx</span><span class="o">=</span><span class="mi">1</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ini_i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
    <span class="n">diff</span><span class="o">=</span><span class="n">N</span><span class="o">-</span><span class="n">ini_i</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ini_i</span><span class="p">)):</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="n">diff</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">idx</span><span class="o">+=</span><span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0 3 5 6]
 [0 0 2 4]
 [0 0 0 1]
 [0 0 0 0]]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Nussinov outsie (ω)</span>
<span class="n">idx</span><span class="o">=</span><span class="mi">1</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j</span><span class="p">):</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">idx</span><span class="o">+=</span><span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[[ 7  4  2  1]
 [ 0  8  5  3]
 [ 0  0  9  6]
 [ 0  0  0 10]]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>

<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            <div>
</div>

            
            
            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://iwasakishuto.github.io/University/3A/情報基礎実験(浅井)-7.html" title="Previous: Pair HMM の最尤推定">Pair HMM の最尤推定</a></li>
                <li class="next-article"><a href="https://iwasakishuto.github.io/University/3A/生物データマイニング論-2.html" title="Next: 主成分分析(PCA)">主成分分析(PCA)</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>

        <div class="span2" style="float:right;font-size:0.9em; text-align: center;">
            <a class="btn-square-pop" onclick="switchVisibility('_article_meta_')">hidden</a>
        </div>

        <div class="span2" id="_article_meta_" style="float:right;font-size:0.9em;">
            <h5>Table of Contents</h5>
            <div id="toc"></div>

            <h5>Published</h5>
            <time itemprop="dateCreated" datetime="2019-10-06T00:00:00+09:00">10 6, 2019</time>

<h5>Last Updated</h5>
<time datetime="2019-10-06T00:00:00+09:00">10 6, 2019</time>

            <h5>Category</h5>
            <a class="category-link" href="https://iwasakishuto.github.io/University/3A/categories.html#qing-bao-ji-chu-shi-yan-qian-jing-ref">情報基礎実験(浅井)</a>
            <h5>Tags</h5>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://iwasakishuto.github.io/University/3A/tags#3a-ref">3A
                    <span>120</span>
</a></li>
                <li><a href="https://iwasakishuto.github.io/University/3A/tags#qing-bao-ji-chu-shi-yan-qian-jing-ref">情報基礎実験(浅井)
                    <span>13</span>
</a></li>
            </ul>
<h5>Contact</h5>
    <a href="https://twitter.com/cabernet_rock" title="My twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fab fa-twitter sidebar-social-links"></i></a>
    <a href="https://github.com/iwasakishuto" title="My github Profile" class="sidebar-social-links" target="_blank">
    <i class="fab fa-github sidebar-social-links"></i></a>
    <a href="https://www.facebook.com/iwasakishuto" title="My facebook Profile" class="sidebar-social-links" target="_blank">
    <i class="fab fa-facebook sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="https://github.com/Pelican-Elegant/elegant/" title="Theme Elegant Home Page">Elegant</a></li>
    </ul>
</div>
</footer>            <script src="https://code.jquery.com/jquery.min.js"></script>
        <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script src="https://iwasakishuto.github.io/js/custom.js"></script>
        <script src="https://iwasakishuto.github.io/js/smooth-scroll.polyfills.min.js"></script>
        <script src="https://iwasakishuto.github.io/js/toc.min.js"></script>
        <script>
            jQuery('#toc').toc({
                'container': 'div.article-content', 
                'selectors': 'h2, h3, h4',
            });
        </script>

    
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/css/jupyter.css" media="screen">
    </body>
    <!-- Theme: Elegant built for Pelican
    License : MIT -->
</html>